<!-- HTML header for doxygen 1.8.4-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.4"/>
<title>Convex: C:/projects/vex/cortex/opt/smartmotor.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0" class="pageheader">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="convex_logo.png"/></td>
  <td width="100%" align="center" valign="bottom"></td>
  <td align="right"></td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.4 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('smartmotor_8h_source.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">smartmotor.h</div>  </div>
</div><!--header-->
<div class="contents">
<a href="smartmotor_8h.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*-----------------------------------------------------------------------------*/</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">/*                                                                             */</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">/*                        Copyright (c) James Pearman                          */</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">/*                                   2013                                      */</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">/*                            All Rights Reserved                              */</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">/*                                                                             */</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">/*-----------------------------------------------------------------------------*/</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">/*                                                                             */</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">/*    Module:     SmartMotorLib.h                                              */</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">/*    Author:     James Pearman                                                */</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">/*    Created:    2 Oct 2012                                                   */</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">/*                V1.10     4 July 2013 - Initial release fopr ChibiOS         */</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">/*                                                                             */</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">/*-----------------------------------------------------------------------------*/</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">/*                                                                             */</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">/*    This file is part of ConVEX.                                             */</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">/*                                                                             */</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">/*    The author is supplying this software for use with the VEX cortex        */</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">/*    control system. ConVEX is free software; you can redistribute it         */</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">/*    and/or modify it under the terms of the GNU General Public License       */</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">/*    as published by the Free Software Foundation; either version 3 of        */</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">/*    the License, or (at your option) any later version.                      */</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment">/*                                                                             */</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">/*    ConVEX is distributed in the hope that it will be useful,                */</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment">/*    but WITHOUT ANY WARRANTY; without even the implied warranty of           */</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment">/*    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the            */</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment">/*    GNU General Public License for more details.                             */</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment">/*                                                                             */</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment">/*    You should have received a copy of the GNU General Public License        */</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment">/*    along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.    */</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment">/*                                                                             */</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment">/*    A special exception to the GPL can be applied should you wish to         */</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment">/*    distribute a combined work that includes ConVEX, without being obliged   */</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment">/*    to provide the source code for any proprietary components.               */</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment">/*    See the file exception.txt for full details of how and when the          */</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment">/*    exception can be applied.                                                */</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment">/*                                                                             */</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment">/*    The author can be contacted on the vex forums as jpearman                */</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment">/*    or electronic mail using jbpearman_at_mac_dot_com                        */</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment">/*    Mentor for team 8888 RoboLancers, Pasadena CA.                           */</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment">/*                                                                             */</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment">/*-----------------------------------------------------------------------------*/</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="preprocessor">#ifndef __SMARTMOTORLIB__</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define __SMARTMOTORLIB__</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment">/*-----------------------------------------------------------------------------*/</span><span class="comment"></span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment">/** @file    smartmotor.h</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment">  * @brief   A port of the smart motor library for ChibiOS/RT, header</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment">*/</span><span class="comment">/*---------------------------------------------------------------------------*/</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="preprocessor">#include &quot;ch.h&quot;</span>         <span class="comment">// needs for all ChibiOS programs</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="preprocessor">#include &quot;hal.h&quot;</span>        <span class="comment">// hardware abstraction layer header</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="vex_8h.html" title="Main vex include file. ">vex.h</a>&quot;</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="comment">// Version 1.03</span></div>
<div class="line"><a name="l00057"></a><span class="lineno"><a class="code" href="smartmotor_8h.html#ab80e173825ae03a2e8bfcdb7aea2f71e">   57</a></span>&#160;<span class="preprocessor">#define kSmartMotorLibVersion   110</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="comment">// System parameters - don&#39;t change</span></div>
<div class="line"><a name="l00060"></a><span class="lineno"><a class="code" href="smartmotor_8h.html#a6388dd5a623f661603122873a8697dd4">   60</a></span>&#160;<span class="preprocessor">#define SMLIB_R_SYS             0.3</span></div>
<div class="line"><a name="l00061"></a><span class="lineno"><a class="code" href="smartmotor_8h.html#a34e32dcad64b0f5201e662504b377128">   61</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define SMLIB_PWM_FREQ          1150</span></div>
<div class="line"><a name="l00062"></a><span class="lineno"><a class="code" href="smartmotor_8h.html#a214e8a6081276bc15c4c8f6c9ea21904">   62</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define SMLIB_V_DIODE           0.75</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="comment">// parameters for vex 393 motor</span></div>
<div class="line"><a name="l00065"></a><span class="lineno"><a class="code" href="smartmotor_8h.html#a6c1a6bbf985f9dbe543098fbf6f53f99">   65</a></span>&#160;<span class="preprocessor">#define SMLIB_I_FREE_393        0.2</span></div>
<div class="line"><a name="l00066"></a><span class="lineno"><a class="code" href="smartmotor_8h.html#a6ea7106d1bb95b9b6c9f8a3eae658350">   66</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define SMLIB_I_STALL_393       4.8</span></div>
<div class="line"><a name="l00067"></a><span class="lineno"><a class="code" href="smartmotor_8h.html#abd5a23c3084d7d4b9785d88cd820a319">   67</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define SMLIB_RPM_FREE_393      110</span></div>
<div class="line"><a name="l00068"></a><span class="lineno"><a class="code" href="smartmotor_8h.html#a41414e1fc55f309b9ffcfee01ac6bd4d">   68</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define SMLIB_R_393             (7.2/SMLIB_I_STALL_393)</span></div>
<div class="line"><a name="l00069"></a><span class="lineno"><a class="code" href="smartmotor_8h.html#a361a5d7bee89975690d01f367c7b25cb">   69</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define SMLIB_L_393             0.000650</span></div>
<div class="line"><a name="l00070"></a><span class="lineno"><a class="code" href="smartmotor_8h.html#aa454c69709543274d656db56545c734f">   70</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define SMLIB_Ke_393            (7.2*(1-SMLIB_I_FREE_393/SMLIB_I_STALL_393)/SMLIB_RPM_FREE_393)</span></div>
<div class="line"><a name="l00071"></a><span class="lineno"><a class="code" href="smartmotor_8h.html#ad02f38938ebbb93585a55688fcbe38b5">   71</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define SMLIB_I_SAFE393         0.90</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="comment">// parameters for vex 269 motor</span></div>
<div class="line"><a name="l00074"></a><span class="lineno"><a class="code" href="smartmotor_8h.html#ae46f78a2f15971d20b89f8990190e352">   74</a></span>&#160;<span class="preprocessor">#define SMLIB_I_FREE_269        0.18</span></div>
<div class="line"><a name="l00075"></a><span class="lineno"><a class="code" href="smartmotor_8h.html#ad202dea8e017c5d8fb6e85c87763dfc8">   75</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define SMLIB_I_STALL_269       2.88</span></div>
<div class="line"><a name="l00076"></a><span class="lineno"><a class="code" href="smartmotor_8h.html#abb57553952be46767a929db555cb75b5">   76</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define SMLIB_RPM_FREE_269      120</span></div>
<div class="line"><a name="l00077"></a><span class="lineno"><a class="code" href="smartmotor_8h.html#a58b2127647e13b3c0186b92c032feddd">   77</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define SMLIB_R_269             (7.2/SMLIB_I_STALL_269)</span></div>
<div class="line"><a name="l00078"></a><span class="lineno"><a class="code" href="smartmotor_8h.html#a575d753a2c85cc08be145b6d8ca3ec56">   78</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define SMLIB_L_269             0.000650</span></div>
<div class="line"><a name="l00079"></a><span class="lineno"><a class="code" href="smartmotor_8h.html#a121b66f079aa60f97c8eed3d638c51c8">   79</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define SMLIB_Ke_269            (7.2*(1-SMLIB_I_FREE_269/SMLIB_I_STALL_269)/SMLIB_RPM_FREE_269)</span></div>
<div class="line"><a name="l00080"></a><span class="lineno"><a class="code" href="smartmotor_8h.html#abb1e4706ce9fff6032c52cc65b7eb927">   80</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define SMLIB_I_SAFE269         0.75</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment">// parameters for cortex and Power expander</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment">// spec says 4A but we have set a little lower here</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment">// may increase in a subsequent release.</span></div>
<div class="line"><a name="l00085"></a><span class="lineno"><a class="code" href="smartmotor_8h.html#adc43850faa54c5f9f09f4a0f771a4f8d">   85</a></span>&#160;<span class="preprocessor">#define SMLIB_I_SAFECORTEX      3.0</span></div>
<div class="line"><a name="l00086"></a><span class="lineno"><a class="code" href="smartmotor_8h.html#a644f93a867c961205ae780d9ce7a662f">   86</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define SMLIB_I_SAFEPE          3.0</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="comment">// encoder counts per revolution depending on motor</span></div>
<div class="line"><a name="l00089"></a><span class="lineno"><a class="code" href="smartmotor_8h.html#a027a0c5766a0f93c12ae64f41e2c5b7e">   89</a></span>&#160;<span class="preprocessor">#define SMLIB_TPR_269           240.448</span></div>
<div class="line"><a name="l00090"></a><span class="lineno"><a class="code" href="smartmotor_8h.html#a89a8eaf0170858342c1bb8822aa2302c">   90</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define SMLIB_TPR_393S          392</span></div>
<div class="line"><a name="l00091"></a><span class="lineno"><a class="code" href="smartmotor_8h.html#a0a076907b1bd72b378ce278b51e8411a">   91</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define SMLIB_TPR_393T          627.2</span></div>
<div class="line"><a name="l00092"></a><span class="lineno"><a class="code" href="smartmotor_8h.html#a0eff7468ad640b65d206c19b70f6a02a">   92</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define SMLIB_TPR_QUAD          360.0</span></div>
<div class="line"><a name="l00093"></a><span class="lineno"><a class="code" href="smartmotor_8h.html#a704019ffa15cf0280b4f8fded864000b">   93</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define SMLIB_TPR_POT           6000.0 // estimate</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment">// Initial ambient temp 72deg F in deg C</span></div>
<div class="line"><a name="l00096"></a><span class="lineno"><a class="code" href="smartmotor_8h.html#af5a10cfb07ba6df58f86f00fbfbac9c9">   96</a></span>&#160;<span class="preprocessor">#define SMLIB_TEMP_AMBIENT      (( 72.0-32.0) * 5 / 9)</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="preprocessor"></span><span class="comment">// Trip temperature for PTC 100 deg C, may be a little low</span></div>
<div class="line"><a name="l00098"></a><span class="lineno"><a class="code" href="smartmotor_8h.html#acba76c731f5021c55eef5b73aad9f1a3">   98</a></span>&#160;<span class="preprocessor">#define SMLIB_TEMP_TRIP         100.0</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="preprocessor"></span><span class="comment">// Trip hysteresis in deg C, once tripped we need a 10 deg drop to enable normal operation</span></div>
<div class="line"><a name="l00100"></a><span class="lineno"><a class="code" href="smartmotor_8h.html#a6e87df0875732bd6e7c2274c6202bd6d">  100</a></span>&#160;<span class="preprocessor">#define SMLIB_TEMP_HYST         10.0</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="preprocessor"></span><span class="comment">// Reference temperature for data below, 25 deg C</span></div>
<div class="line"><a name="l00102"></a><span class="lineno"><a class="code" href="smartmotor_8h.html#acd1380aa009635795762e73e9acdba1f">  102</a></span>&#160;<span class="preprocessor">#define SMLIB_TEMP_REF          25.0</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="comment">// Hold current is the current where thr PTC should not trip</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="comment">// Time to trip is the time at 5 x hold current</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="comment">// K_TAU is a safety factor, probably 0.5 ~ 0.8</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="comment">// we are being conservative here, it trip occurs too soon then increase</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment">// PTC HR16-400 used in cortex and power expander</span></div>
<div class="line"><a name="l00110"></a><span class="lineno"><a class="code" href="smartmotor_8h.html#acab94a99867a8f1e8bc903ea0bde7f4c">  110</a></span>&#160;<span class="preprocessor">#define SMLIB_I_HOLD_CORTEX     3.0</span></div>
<div class="line"><a name="l00111"></a><span class="lineno"><a class="code" href="smartmotor_8h.html#a4726683afdc4bd7dcceed61d1607d9f8">  111</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define SMLIB_T_TRIP_CORTEX     1.7</span></div>
<div class="line"><a name="l00112"></a><span class="lineno"><a class="code" href="smartmotor_8h.html#ac0bd873634e0b29ad9749dd4339c66c6">  112</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define SMLIB_K_TAU_CORTEX      0.5</span></div>
<div class="line"><a name="l00113"></a><span class="lineno"><a class="code" href="smartmotor_8h.html#ad0a34f5fa30e52d249e730547117e716">  113</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define SMLIB_TAU_CORTEX        (SMLIB_K_TAU_CORTEX * SMLIB_T_TRIP_CORTEX * 5.0 * 5.0)</span></div>
<div class="line"><a name="l00114"></a><span class="lineno"><a class="code" href="smartmotor_8h.html#a9691fb90399d639da6f412d0fd6f8e24">  114</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define SMLIB_C1_CORTEX         ( (SMLIB_TEMP_TRIP - SMLIB_TEMP_REF) / (SMLIB_I_HOLD_CORTEX * SMLIB_I_HOLD_CORTEX) )</span></div>
<div class="line"><a name="l00115"></a><span class="lineno"><a class="code" href="smartmotor_8h.html#a035d32d7b415402d6fdc4b71b0e906ea">  115</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define SMLIB_C2_CORTEX         (1.0 / (SMLIB_TAU_CORTEX * 1000.0))</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment">// PTC HR30-090 used in 393</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="comment">//#define SMLIB_I_HOLD_393      0.9</span></div>
<div class="line"><a name="l00119"></a><span class="lineno"><a class="code" href="smartmotor_8h.html#a9f5bb58eaf5b6933920406f14b432cfa">  119</a></span>&#160;<span class="preprocessor">#define SMLIB_I_HOLD_393        1.0 // increased a little to slow down trip</span></div>
<div class="line"><a name="l00120"></a><span class="lineno"><a class="code" href="smartmotor_8h.html#a7ca3f104e1ba9161dc6769c4a38c0c6e">  120</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define SMLIB_T_TRIP_393        7.1</span></div>
<div class="line"><a name="l00121"></a><span class="lineno"><a class="code" href="smartmotor_8h.html#a1b68377ac29de1a3e4984b64b08c5347">  121</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define SMLIB_K_TAU_393         0.5</span></div>
<div class="line"><a name="l00122"></a><span class="lineno"><a class="code" href="smartmotor_8h.html#ad4ec367ffc46b6e71d773ce38c1c11a2">  122</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define SMLIB_TAU_393           (SMLIB_K_TAU_393 * SMLIB_T_TRIP_393 * 5.0 * 5.0)</span></div>
<div class="line"><a name="l00123"></a><span class="lineno"><a class="code" href="smartmotor_8h.html#a5b9974b565d3c135b4adb6f3295f7790">  123</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define SMLIB_C1_393            ( (SMLIB_TEMP_TRIP - SMLIB_TEMP_REF) / (SMLIB_I_HOLD_393 * SMLIB_I_HOLD_393) )</span></div>
<div class="line"><a name="l00124"></a><span class="lineno"><a class="code" href="smartmotor_8h.html#aded8542342b1f5e6945bfe8dd000d3f3">  124</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define SMLIB_C2_393            (1.0 / (SMLIB_TAU_393 * 1000.0))</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="comment">// PTC HR16-075 used in 269</span></div>
<div class="line"><a name="l00127"></a><span class="lineno"><a class="code" href="smartmotor_8h.html#af10c07efc3558b3e6b9bbc97484bcfb7">  127</a></span>&#160;<span class="preprocessor">#define SMLIB_I_HOLD_269        0.75</span></div>
<div class="line"><a name="l00128"></a><span class="lineno"><a class="code" href="smartmotor_8h.html#a7780ce3d14c2f7d140fd74a58eaf20d0">  128</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define SMLIB_T_TRIP_269        2.0</span></div>
<div class="line"><a name="l00129"></a><span class="lineno"><a class="code" href="smartmotor_8h.html#ad6279238fcb7bfc72979175a064f46b3">  129</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define SMLIB_K_TAU_269         0.5</span></div>
<div class="line"><a name="l00130"></a><span class="lineno"><a class="code" href="smartmotor_8h.html#a52e31feb77d2d24006ad87eed34e466c">  130</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define SMLIB_TAU_269           (SMLIB_K_TAU_269 * SMLIB_T_TRIP_269 * 5.0 * 5.0)</span></div>
<div class="line"><a name="l00131"></a><span class="lineno"><a class="code" href="smartmotor_8h.html#a2272a6c19029f7caba52ac37dfcaa0df">  131</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define SMLIB_C1_269            ( (SMLIB_TEMP_TRIP - SMLIB_TEMP_REF) / (SMLIB_I_HOLD_269 * SMLIB_I_HOLD_269) )</span></div>
<div class="line"><a name="l00132"></a><span class="lineno"><a class="code" href="smartmotor_8h.html#ab0f0fe92b6483f6e672f2c26bc34d7b7">  132</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define SMLIB_C2_269            (1.0 / (SMLIB_TAU_269 * 1000.0))</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="comment">// No way to test 3 wire - Vamfun had them more or less the same as the 269</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="comment">// PTC MINISMDC-075F used in three wire</span></div>
<div class="line"><a name="l00136"></a><span class="lineno"><a class="code" href="smartmotor_8h.html#a4de54488068432487432e2b7d932b91d">  136</a></span>&#160;<span class="preprocessor">#define SMLIB_C1_3WIRE          SMLIB_C1_269</span></div>
<div class="line"><a name="l00137"></a><span class="lineno"><a class="code" href="smartmotor_8h.html#a0874211e5690bbdb8b92ef9b657c39b5">  137</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define SMLIB_C2_3WIRE          SMLIB_C2_269</span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00139"></a><span class="lineno"><a class="code" href="smartmotor_8h.html#ace2b744f415433395f16f15466761675">  139</a></span>&#160;<span class="preprocessor">#define SMLIB_LEDON             0</span></div>
<div class="line"><a name="l00140"></a><span class="lineno"><a class="code" href="smartmotor_8h.html#afe2a83021ba049416dbe4de5a7a15d8e">  140</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define SMLIB_LEDOFF            1</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="comment">/*-----------------------------------------------------------------------------*/</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="comment">/*                                                                             */</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="comment">/*  This large structure holds all the needed information for a single motor   */</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="comment">/*                                                                             */</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="comment">/*  The constants used in calculations are all set automatically by the init   */</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="comment">/*  code.  Other variables are used by the different functions to calculate    */</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="comment">/*  speed, current and temperature.  some of these are stored for debug        */</span></div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="comment">/*  purposes                                                                   */</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="comment">/*                                                                             */</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="comment">/*  V1.02 code uses 124 bytes (a couple are wasted due to word alignment)      */</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="comment">/*  so 1240 bytes in all for the 10 motors.                                    */</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="comment">/*-----------------------------------------------------------------------------*/</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;</div>
<div class="line"><a name="l00156"></a><span class="lineno"><a class="code" href="structsmart_motor.html">  156</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    <span class="comment">// the motor port</span></div>
<div class="line"><a name="l00158"></a><span class="lineno"><a class="code" href="structsmart_motor.html#a7735a4a01bd3f6c908aa37dfd1c4bc77">  158</a></span>&#160;    <a class="code" href="vexmotor_8h.html#a1233a4fb09fef02c962ccec318e00c97" title="Motor port numbers. ">tVexMotor</a>      <a class="code" href="structsmart_motor.html#a7735a4a01bd3f6c908aa37dfd1c4bc77">port</a>;</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <span class="comment">// the motor encoder port</span></div>
<div class="line"><a name="l00161"></a><span class="lineno"><a class="code" href="structsmart_motor.html#a0e68e94f18b0ff4e892c320848ab0639">  161</a></span>&#160;    <a class="code" href="vexmotor_8h.html#a1233a4fb09fef02c962ccec318e00c97" title="Motor port numbers. ">tVexMotor</a>      <a class="code" href="structsmart_motor.html#a0e68e94f18b0ff4e892c320848ab0639">eport</a>;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <span class="comment">// copy of the system motor type</span></div>
<div class="line"><a name="l00164"></a><span class="lineno"><a class="code" href="structsmart_motor.html#a8ec107c17aab9518e5ecd9dc92c76d4d">  164</a></span>&#160;    <a class="code" href="vexmotor_8h.html#a62170b45bb8b2b6c66889914eb602819" title="Motor types. ">tVexMotorType</a>  <a class="code" href="structsmart_motor.html#a8ec107c17aab9518e5ecd9dc92c76d4d">type</a>;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <span class="comment">// due to alignment we get a free variable here</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="comment">// use for debugging loop delay</span></div>
<div class="line"><a name="l00168"></a><span class="lineno"><a class="code" href="structsmart_motor.html#a5a8cc605943c4c91758a5f6e286fa53d">  168</a></span>&#160;    <span class="keywordtype">short</span>       <a class="code" href="structsmart_motor.html#a5a8cc605943c4c91758a5f6e286fa53d">delayTimeMs</a>;</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <span class="comment">// pointer to our control bank</span></div>
<div class="line"><a name="l00171"></a><span class="lineno"><a class="code" href="structsmart_motor.html#aecd486e3b16d7f8358c9609f29b835a7">  171</a></span>&#160;    <span class="keyword">struct </span><a class="code" href="struct__smart_controller.html">_smartController</a> *<a class="code" href="structsmart_motor.html#aecd486e3b16d7f8358c9609f29b835a7">bank</a>;</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    <span class="comment">// commanded speed comes from the user</span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <span class="comment">// requested speed is either the commanded speed or limited speed if the PTC</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    <span class="comment">// is about to trip</span></div>
<div class="line"><a name="l00176"></a><span class="lineno"><a class="code" href="structsmart_motor.html#a32cb403d82c7a72c08df429f3a76096c">  176</a></span>&#160;    <span class="keywordtype">short</span>   <a class="code" href="structsmart_motor.html#a32cb403d82c7a72c08df429f3a76096c">motor_cmd</a>;</div>
<div class="line"><a name="l00177"></a><span class="lineno"><a class="code" href="structsmart_motor.html#a8c6f182fc154832a1bb2e660ec8a3388">  177</a></span>&#160;    <span class="keywordtype">short</span>   <a class="code" href="structsmart_motor.html#a8c6f182fc154832a1bb2e660ec8a3388">motor_req</a>;</div>
<div class="line"><a name="l00178"></a><span class="lineno"><a class="code" href="structsmart_motor.html#a1f9116b7901118748446909fe306c558">  178</a></span>&#160;    <span class="keywordtype">short</span>   <a class="code" href="structsmart_motor.html#a1f9116b7901118748446909fe306c558">motor_slew</a>;</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    <span class="comment">// current limit and max cmd value</span></div>
<div class="line"><a name="l00181"></a><span class="lineno"><a class="code" href="structsmart_motor.html#a5b38711518002d09c8c353aa9a0493a1">  181</a></span>&#160;    <span class="keywordtype">short</span>   <a class="code" href="structsmart_motor.html#a5b38711518002d09c8c353aa9a0493a1">limit_tripped</a>;</div>
<div class="line"><a name="l00182"></a><span class="lineno"><a class="code" href="structsmart_motor.html#ac5aa51635e29ab6a14684bd488ed31a8">  182</a></span>&#160;    <span class="keywordtype">short</span>   <a class="code" href="structsmart_motor.html#ac5aa51635e29ab6a14684bd488ed31a8">limit_cmd</a>;</div>
<div class="line"><a name="l00183"></a><span class="lineno"><a class="code" href="structsmart_motor.html#a67f5d09fdefa7a01506508bb37395ae8">  183</a></span>&#160;    <span class="keywordtype">float</span>   <a class="code" href="structsmart_motor.html#a67f5d09fdefa7a01506508bb37395ae8">limit_current</a>;</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <span class="comment">// the encoder associated with this motor</span></div>
<div class="line"><a name="l00186"></a><span class="lineno"><a class="code" href="structsmart_motor.html#ad01c842cb69c1807c00f0a0c13d71254">  186</a></span>&#160;    <span class="keywordtype">short</span>   <a class="code" href="structsmart_motor.html#ad01c842cb69c1807c00f0a0c13d71254">encoder_id</a>;</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <span class="comment">// encoder ticks per rev</span></div>
<div class="line"><a name="l00188"></a><span class="lineno"><a class="code" href="structsmart_motor.html#a3f9e294d86d5eedec4eee2085cc87cbc">  188</a></span>&#160;    <span class="keywordtype">float</span>   <a class="code" href="structsmart_motor.html#a3f9e294d86d5eedec4eee2085cc87cbc">ticks_per_rev</a>;</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <span class="comment">// variables used by rpm calculation</span></div>
<div class="line"><a name="l00191"></a><span class="lineno"><a class="code" href="structsmart_motor.html#ab4877a401ccd78b708adb9894bc596c2">  191</a></span>&#160;    <span class="keywordtype">long</span>    <a class="code" href="structsmart_motor.html#ab4877a401ccd78b708adb9894bc596c2">enc</a>;</div>
<div class="line"><a name="l00192"></a><span class="lineno"><a class="code" href="structsmart_motor.html#a2b59c8394f5ca2b58ee4edd32714d95f">  192</a></span>&#160;    <span class="keywordtype">long</span>    <a class="code" href="structsmart_motor.html#a2b59c8394f5ca2b58ee4edd32714d95f">oldenc</a>;</div>
<div class="line"><a name="l00193"></a><span class="lineno"><a class="code" href="structsmart_motor.html#a1ee4a05b54419bfadd66ee351d05812e">  193</a></span>&#160;    <span class="keywordtype">float</span>   <a class="code" href="structsmart_motor.html#a1ee4a05b54419bfadd66ee351d05812e">delta</a>;</div>
<div class="line"><a name="l00194"></a><span class="lineno"><a class="code" href="structsmart_motor.html#a25e39b399c2a11f0d76e42ab8241a910">  194</a></span>&#160;    <span class="keywordtype">float</span>   <a class="code" href="structsmart_motor.html#a25e39b399c2a11f0d76e42ab8241a910">rpm</a>;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    <span class="comment">// variables used for current calculation</span></div>
<div class="line"><a name="l00197"></a><span class="lineno"><a class="code" href="structsmart_motor.html#aa925c690baf7b9ffde1808db333d22e6">  197</a></span>&#160;    <span class="keywordtype">float</span>   <a class="code" href="structsmart_motor.html#aa925c690baf7b9ffde1808db333d22e6">i_free</a>;</div>
<div class="line"><a name="l00198"></a><span class="lineno"><a class="code" href="structsmart_motor.html#acebfcc998f2efd99354dfdbfd273fde0">  198</a></span>&#160;    <span class="keywordtype">float</span>   <a class="code" href="structsmart_motor.html#acebfcc998f2efd99354dfdbfd273fde0">i_stall</a>;</div>
<div class="line"><a name="l00199"></a><span class="lineno"><a class="code" href="structsmart_motor.html#a9364cc0b4bf508bf27d00d647be5b628">  199</a></span>&#160;    <span class="keywordtype">float</span>   <a class="code" href="structsmart_motor.html#a9364cc0b4bf508bf27d00d647be5b628">r_motor</a>;</div>
<div class="line"><a name="l00200"></a><span class="lineno"><a class="code" href="structsmart_motor.html#ab041b3ad984a1f4dcf26f876329337cf">  200</a></span>&#160;    <span class="keywordtype">float</span>   <a class="code" href="structsmart_motor.html#ab041b3ad984a1f4dcf26f876329337cf">l_motor</a>;</div>
<div class="line"><a name="l00201"></a><span class="lineno"><a class="code" href="structsmart_motor.html#abb1346bf73232bb2a5ef31bb42022a57">  201</a></span>&#160;    <span class="keywordtype">float</span>   <a class="code" href="structsmart_motor.html#abb1346bf73232bb2a5ef31bb42022a57">ke_motor</a>;</div>
<div class="line"><a name="l00202"></a><span class="lineno"><a class="code" href="structsmart_motor.html#a94f9b1c324c7f8d48f0457b966a80f57">  202</a></span>&#160;    <span class="keywordtype">float</span>   <a class="code" href="structsmart_motor.html#a94f9b1c324c7f8d48f0457b966a80f57">rpm_free</a>;</div>
<div class="line"><a name="l00203"></a><span class="lineno"><a class="code" href="structsmart_motor.html#ae7906dec6c4ff98e3617aafff374a3d0">  203</a></span>&#160;    <span class="keywordtype">float</span>   <a class="code" href="structsmart_motor.html#ae7906dec6c4ff98e3617aafff374a3d0">v_bemf_max</a>;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    <span class="comment">// instantaneous current</span></div>
<div class="line"><a name="l00206"></a><span class="lineno"><a class="code" href="structsmart_motor.html#af9653d31acfffa5a40aa709b2065e00b">  206</a></span>&#160;    <span class="keywordtype">float</span>   <a class="code" href="structsmart_motor.html#af9653d31acfffa5a40aa709b2065e00b">current</a>;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <span class="comment">// a filtered version of current to remove some transients</span></div>
<div class="line"><a name="l00208"></a><span class="lineno"><a class="code" href="structsmart_motor.html#a07814c46e9dd8d75664a29e0ae47fb9c">  208</a></span>&#160;    <span class="keywordtype">float</span>   <a class="code" href="structsmart_motor.html#a07814c46e9dd8d75664a29e0ae47fb9c">filtered_current</a>;</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    <span class="comment">// peak measured current</span></div>
<div class="line"><a name="l00210"></a><span class="lineno"><a class="code" href="structsmart_motor.html#a61eb9d5dcca443d300bc077407243003">  210</a></span>&#160;    <span class="keywordtype">float</span>   <a class="code" href="structsmart_motor.html#a61eb9d5dcca443d300bc077407243003">peak_current</a>;</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <span class="comment">// holds safe current for this motor</span></div>
<div class="line"><a name="l00213"></a><span class="lineno"><a class="code" href="structsmart_motor.html#ab7b13ae5d90dac63ae7a1f946858e15d">  213</a></span>&#160;    <span class="keywordtype">float</span>   <a class="code" href="structsmart_motor.html#ab7b13ae5d90dac63ae7a1f946858e15d">safe_current</a>;</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <span class="comment">// target current in limited mode</span></div>
<div class="line"><a name="l00215"></a><span class="lineno"><a class="code" href="structsmart_motor.html#ad0dde8cc8b9f87ad0bfa060e67a9c9b7">  215</a></span>&#160;    <span class="keywordtype">float</span>   <a class="code" href="structsmart_motor.html#ad0dde8cc8b9f87ad0bfa060e67a9c9b7">target_current</a>;</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    <span class="comment">// PTC monitor variables</span></div>
<div class="line"><a name="l00218"></a><span class="lineno"><a class="code" href="structsmart_motor.html#afc1d28cfbce795d6ea954ebe725241f5">  218</a></span>&#160;    <span class="keywordtype">float</span>   <a class="code" href="structsmart_motor.html#afc1d28cfbce795d6ea954ebe725241f5">temperature</a>;</div>
<div class="line"><a name="l00219"></a><span class="lineno"><a class="code" href="structsmart_motor.html#a85b4f95629f24a02ddd5acc1083e28e7">  219</a></span>&#160;    <span class="keywordtype">float</span>   <a class="code" href="structsmart_motor.html#a85b4f95629f24a02ddd5acc1083e28e7">t_const_1</a>;</div>
<div class="line"><a name="l00220"></a><span class="lineno"><a class="code" href="structsmart_motor.html#a57b6d55826de8929ada8473d2a1ae1d4">  220</a></span>&#160;    <span class="keywordtype">float</span>   <a class="code" href="structsmart_motor.html#a57b6d55826de8929ada8473d2a1ae1d4">t_const_2</a>;</div>
<div class="line"><a name="l00221"></a><span class="lineno"><a class="code" href="structsmart_motor.html#a936368dc952e987e0b81db35f4e35bc2">  221</a></span>&#160;    <span class="keywordtype">float</span>   <a class="code" href="structsmart_motor.html#a936368dc952e987e0b81db35f4e35bc2">t_ambient</a>;</div>
<div class="line"><a name="l00222"></a><span class="lineno"><a class="code" href="structsmart_motor.html#a0cb2f86584d6f4553d0dc69bb3ed9161">  222</a></span>&#160;    <span class="keywordtype">short</span>   <a class="code" href="structsmart_motor.html#a0cb2f86584d6f4553d0dc69bb3ed9161">ptc_tripped</a>;</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <span class="comment">// Last program time we ran - may not keep this, bit overkill</span></div>
<div class="line"><a name="l00225"></a><span class="lineno"><a class="code" href="structsmart_motor.html#a8895a12eecc57e45becfceb4027bed2d">  225</a></span>&#160;    <span class="keywordtype">long</span>    <a class="code" href="structsmart_motor.html#a8895a12eecc57e45becfceb4027bed2d">lastPgmTime</a>;</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    } <a class="code" href="structsmart_motor.html">smartMotor</a>;</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="comment">/*-----------------------------------------------------------------------------*/</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="comment">/*  Motor control related definitions                                          */</span></div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="comment">/*-----------------------------------------------------------------------------*/</span></div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;</div>
<div class="line"><a name="l00232"></a><span class="lineno"><a class="code" href="smartmotor_8h.html#a90396a4a6e644b2e3caffd8b0501891e">  232</a></span>&#160;<span class="preprocessor">#define SMLIB_MOTOR_MAX_CMD             127     // maximum command value to motor</span></div>
<div class="line"><a name="l00233"></a><span class="lineno"><a class="code" href="smartmotor_8h.html#a49ac85d762f53f78af2bc69817da90bf">  233</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define SMLIB_MOTOR_MIN_CMD             (-127)  // minimum command value to motor</span></div>
<div class="line"><a name="l00234"></a><span class="lineno"><a class="code" href="smartmotor_8h.html#a5b58efb53615b8fe3b084dd059629be8">  234</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define SMLIB_MOTOR_DEFAULT_SLEW_RATE   10      // Default will cause 375mS from full fwd to rev</span></div>
<div class="line"><a name="l00235"></a><span class="lineno"><a class="code" href="smartmotor_8h.html#aa575abdf4edda8767235b06be8216693">  235</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define SMLIB_MOTOR_FAST_SLEW_RATE      256     // essentially off</span></div>
<div class="line"><a name="l00236"></a><span class="lineno"><a class="code" href="smartmotor_8h.html#ac9a633aebd7a28d8233939b92869e124">  236</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define SMLIB_MOTOR_DEADBAND            10      // values below this are set to 0</span></div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;<span class="comment">// When current limit is not needed set limit_cmd to this value</span></div>
<div class="line"><a name="l00239"></a><span class="lineno"><a class="code" href="smartmotor_8h.html#a978b7f5e2c910017ad6e98c177a2e6c9">  239</a></span>&#160;<span class="preprocessor">#define SMLIB_MOTOR_MAX_CMD_UNDEFINED   255     // special value for limit_motor</span></div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="comment">/*-----------------------------------------------------------------------------*/</span></div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;<span class="comment">/*                                                                             */</span></div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="comment">/*  This structure holds all the information for a controller bank             */</span></div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="comment">/*  which is a PTC protected circuit in the cortex or power expander           */</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="comment">/*                                                                             */</span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="comment">/*  We limit storage to three banks as that is the limit for a VEX competition */</span></div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="comment">/*  robot although you could have more power expanders in theory               */</span></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;<span class="comment">/*                                                                             */</span></div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<span class="comment">/*  V1.00 code uses 52 bytes per bank                                          */</span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="comment">/*-----------------------------------------------------------------------------*/</span></div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="comment">// 3 banks of maximum 5 motors (even though power expander is 4)</span></div>
<div class="line"><a name="l00253"></a><span class="lineno"><a class="code" href="smartmotor_8h.html#ab5abe0033a9253a2730e7d8576c66bb5">  253</a></span>&#160;<span class="preprocessor">#define SMLIB_TOTAL_NUM_CONTROL_BANKS   3</span></div>
<div class="line"><a name="l00254"></a><span class="lineno"><a class="code" href="smartmotor_8h.html#a61b4143e536cac345d802f7f7c65d1e8">  254</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define SMLIB_TOTAL_NUM_BANK_MOTORS     5</span></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;<span class="preprocessor"></span><span class="comment">// Index for banks</span></div>
<div class="line"><a name="l00256"></a><span class="lineno"><a class="code" href="smartmotor_8h.html#a3c732724da6745cb4ed30eb38f499808">  256</a></span>&#160;<span class="preprocessor">#define SMLIB_CORTEX_PORT_0             0</span></div>
<div class="line"><a name="l00257"></a><span class="lineno"><a class="code" href="smartmotor_8h.html#ae2170b87b4ef0120f52a2af889cb9de9">  257</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define SMLIB_CORTEX_PORT_1             1</span></div>
<div class="line"><a name="l00258"></a><span class="lineno"><a class="code" href="smartmotor_8h.html#acac4eec922a59145f255dacade750fcc">  258</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define SMLIB_PWREXP_PORT_0             2</span></div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00260"></a><span class="lineno"><a class="code" href="struct__smart_controller.html">  260</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="struct__smart_controller.html">_smartController</a> {</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    <span class="comment">// array of pointers to the motors</span></div>
<div class="line"><a name="l00262"></a><span class="lineno"><a class="code" href="struct__smart_controller.html#aeb59f89d25d6bd4a5e3050e09555c526">  262</a></span>&#160;    <a class="code" href="structsmart_motor.html">smartMotor</a> *<a class="code" href="struct__smart_controller.html#aeb59f89d25d6bd4a5e3050e09555c526">motors</a>[<a class="code" href="smartmotor_8h.html#a61b4143e536cac345d802f7f7c65d1e8">SMLIB_TOTAL_NUM_BANK_MOTORS</a>];</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <span class="comment">// cumulative current</span></div>
<div class="line"><a name="l00265"></a><span class="lineno"><a class="code" href="struct__smart_controller.html#af9653d31acfffa5a40aa709b2065e00b">  265</a></span>&#160;    <span class="keywordtype">float</span>  <a class="code" href="struct__smart_controller.html#af9653d31acfffa5a40aa709b2065e00b">current</a>;</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    <span class="comment">// peak measured current</span></div>
<div class="line"><a name="l00267"></a><span class="lineno"><a class="code" href="struct__smart_controller.html#a61eb9d5dcca443d300bc077407243003">  267</a></span>&#160;    <span class="keywordtype">float</span>  <a class="code" href="struct__smart_controller.html#a61eb9d5dcca443d300bc077407243003">peak_current</a>;</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    <span class="comment">// holds safe current for this motor</span></div>
<div class="line"><a name="l00269"></a><span class="lineno"><a class="code" href="struct__smart_controller.html#ab7b13ae5d90dac63ae7a1f946858e15d">  269</a></span>&#160;    <span class="keywordtype">float</span>  <a class="code" href="struct__smart_controller.html#ab7b13ae5d90dac63ae7a1f946858e15d">safe_current</a>;</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    <span class="comment">// PTC monitor variables</span></div>
<div class="line"><a name="l00272"></a><span class="lineno"><a class="code" href="struct__smart_controller.html#afc1d28cfbce795d6ea954ebe725241f5">  272</a></span>&#160;    <span class="keywordtype">float</span>  <a class="code" href="struct__smart_controller.html#afc1d28cfbce795d6ea954ebe725241f5">temperature</a>;</div>
<div class="line"><a name="l00273"></a><span class="lineno"><a class="code" href="struct__smart_controller.html#a85b4f95629f24a02ddd5acc1083e28e7">  273</a></span>&#160;    <span class="keywordtype">float</span>  <a class="code" href="struct__smart_controller.html#a85b4f95629f24a02ddd5acc1083e28e7">t_const_1</a>;</div>
<div class="line"><a name="l00274"></a><span class="lineno"><a class="code" href="struct__smart_controller.html#a57b6d55826de8929ada8473d2a1ae1d4">  274</a></span>&#160;    <span class="keywordtype">float</span>  <a class="code" href="struct__smart_controller.html#a57b6d55826de8929ada8473d2a1ae1d4">t_const_2</a>;</div>
<div class="line"><a name="l00275"></a><span class="lineno"><a class="code" href="struct__smart_controller.html#a936368dc952e987e0b81db35f4e35bc2">  275</a></span>&#160;    <span class="keywordtype">float</span>  <a class="code" href="struct__smart_controller.html#a936368dc952e987e0b81db35f4e35bc2">t_ambient</a>;</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    <span class="comment">// flag for ptc status</span></div>
<div class="line"><a name="l00278"></a><span class="lineno"><a class="code" href="struct__smart_controller.html#a0cb2f86584d6f4553d0dc69bb3ed9161">  278</a></span>&#160;    <span class="keywordtype">short</span>  <a class="code" href="struct__smart_controller.html#a0cb2f86584d6f4553d0dc69bb3ed9161">ptc_tripped</a>;</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    <span class="comment">// Do we have an led to show tripped status</span></div>
<div class="line"><a name="l00281"></a><span class="lineno"><a class="code" href="struct__smart_controller.html#ae1218c8ebf4e1e11ffe0b1bb39239079">  281</a></span>&#160;    <a class="code" href="vexdigital_8h.html#ada6c474f1f434058485c115c087767ca" title="Digital pin indexes. ">tVexDigitalPin</a> <a class="code" href="struct__smart_controller.html#ae1218c8ebf4e1e11ffe0b1bb39239079">statusLed</a>;</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    <span class="comment">// Power expander may have a status port</span></div>
<div class="line"><a name="l00284"></a><span class="lineno"><a class="code" href="struct__smart_controller.html#a19cd451e510d94a280e12848a895ce69">  284</a></span>&#160;    <a class="code" href="vexanalog_8h.html#ab4e1c36487e5604a953fd4112fa1a8e9" title="enumeration for the 8 analog ports ">tVexAnalogPin</a> <a class="code" href="struct__smart_controller.html#a19cd451e510d94a280e12848a895ce69">statusPort</a>;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    } <a class="code" href="smartmotor_8h.html#a038312e31f0a150c09f5b50ee3a1121a">smartController</a>;</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;<span class="comment">// We have no inline so use a macro as shortcut to get ptr</span></div>
<div class="line"><a name="l00289"></a><span class="lineno"><a class="code" href="smartmotor_8h.html#a739e5de7622365612b4bb2e4cb3df719">  289</a></span>&#160;<span class="preprocessor">#define _SmartMotorGetPtr( index ) ((smartMotor *)&amp;sMotors[ index ])</span></div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;<span class="preprocessor"></span><span class="comment">// We have no inline so use a macro as shortcut to get ptr</span></div>
<div class="line"><a name="l00291"></a><span class="lineno"><a class="code" href="smartmotor_8h.html#a77b4d54ee4211a6eeea42aa261aea78e">  291</a></span>&#160;<span class="preprocessor">#define _SmartMotorControllerGetPtr( index ) ((smartController *)&amp;sPorts[ index ])</span></div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;<span class="comment">// Initialization</span></div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;<span class="keywordtype">void</span>             <a class="code" href="smartmotor_8c.html#a2be3709e56aca10845831edf10907f8b" title="Initialize the smartMotor library. ">SmartMotorsInit</a>( <span class="keywordtype">void</span> );</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;<span class="keywordtype">void</span>             <a class="code" href="smartmotor_8c.html#af7ebb6f77c993c91003bc393b7df48c9" title="Link two motors. ">SmartMotorLinkMotors</a>( <a class="code" href="vexmotor_8h.html#a1233a4fb09fef02c962ccec318e00c97" title="Motor port numbers. ">tVexMotor</a> master, <a class="code" href="vexmotor_8h.html#a1233a4fb09fef02c962ccec318e00c97" title="Motor port numbers. ">tVexMotor</a> slave );</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;<span class="keywordtype">void</span>             <a class="code" href="smartmotor_8c.html#a1a0a2b9697fd209af3a4e30d3519551c" title="Set the encoder gearing. ">SmartMotorsSetEncoderGearing</a>( <a class="code" href="vexmotor_8h.html#a1233a4fb09fef02c962ccec318e00c97" title="Motor port numbers. ">tVexMotor</a> index, <span class="keywordtype">float</span> ratio );</div>
<div class="line"><a name="l00297"></a><span class="lineno"><a class="code" href="smartmotor_8h.html#a43541bd57f154397cee046254e8b1b21">  297</a></span>&#160;<span class="preprocessor">#define          SmartMotorsAddPowerExtender( p0, ... ) \</span></div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;<span class="preprocessor">                 _SmartMotorsAddPowerExtender( p0, ##__VA_ARGS__, -1, -1, -1 )</span></div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;<span class="preprocessor"></span><span class="keywordtype">void</span>             <a class="code" href="smartmotor_8c.html#ac620eaa25a2d711bde154e7bcdefec28" title="Add a power extender to the system. ">_SmartMotorsAddPowerExtender</a>( <span class="keywordtype">int</span> p0, <span class="keywordtype">int</span> p1, <span class="keywordtype">int</span> p2, <span class="keywordtype">int</span> p3, ... );</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="comment">// Status</span></div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="keywordtype">float</span>            <a class="code" href="smartmotor_8c.html#a508729e7582e59f5fcfc5c85d0fcb644" title="Get Motor speed. ">SmartMotorGetSpeed</a>( <a class="code" href="vexmotor_8h.html#a1233a4fb09fef02c962ccec318e00c97" title="Motor port numbers. ">tVexMotor</a> index );</div>
<div class="line"><a name="l00303"></a><span class="lineno"><a class="code" href="smartmotor_8h.html#a519083be3c0c7e232060c83de4168ad8">  303</a></span>&#160;<span class="preprocessor">#define          SmartMotorGetCurrent(index, ... ) \</span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="preprocessor">                 _SmartMotorGetCurrent( index, ##__VA_ARGS__, 0 )</span></div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;<span class="preprocessor"></span><span class="keywordtype">float</span>            <a class="code" href="smartmotor_8c.html#a2370585f658aa24f640eaf01234cdc78" title="Get Motor current. ">_SmartMotorGetCurrent</a>( <a class="code" href="vexmotor_8h.html#a1233a4fb09fef02c962ccec318e00c97" title="Motor port numbers. ">tVexMotor</a> index, <span class="keywordtype">int</span> s, ... );</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="keywordtype">float</span>            <a class="code" href="smartmotor_8c.html#a6e4301736618b16e1f840ef14af52376" title="Get Motor temperature. ">SmartMotorGetTemperature</a>( <a class="code" href="vexmotor_8h.html#a1233a4fb09fef02c962ccec318e00c97" title="Motor port numbers. ">tVexMotor</a> index );</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;<span class="keywordtype">int</span>              <a class="code" href="smartmotor_8c.html#aee31e9da2d707ac77d438831ab68b9ca" title="Get Motor command limit. ">SmartMotorGetLimitCmd</a>( <a class="code" href="vexmotor_8h.html#a1233a4fb09fef02c962ccec318e00c97" title="Motor port numbers. ">tVexMotor</a> index );</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;<span class="keywordtype">float</span>            <a class="code" href="smartmotor_8c.html#a7ea0865838afe94f1e9f35fe12e6e4f9" title="Get Controller current. ">SmartMotorGetControllerCurrent</a>( <span class="keywordtype">short</span> index );</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="keywordtype">float</span>            <a class="code" href="smartmotor_8c.html#a2dee899c49cbfda9ac76950263ba1244" title="Get Controller temperature. ">SmartMotorGetControllerTemperature</a>( <span class="keywordtype">short</span> index );</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;<span class="comment">// Control</span></div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;<span class="keywordtype">void</span>             <a class="code" href="smartmotor_8c.html#a904612dd738c965769a62093603b1c2f" title="Enable current limit by monitoring the PTC temperatures. ">SmartMotorPtcMonitorEnable</a>( <span class="keywordtype">void</span> );</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="keywordtype">void</span>             <a class="code" href="smartmotor_8c.html#a8f0197a2264c27235ce1e880710374f3" title="Disable current limit by monitoring the PTC temperatures. ">SmartMotorPtcMonitorDisable</a>( <span class="keywordtype">void</span> );</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="keywordtype">void</span>             <a class="code" href="smartmotor_8c.html#a020fdcd1790e710d138e7d61b7e0dd37" title="Enable current limit by using a preset threshold. ">SmartMotorCurrentMonitorEnable</a>( <span class="keywordtype">void</span> );</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="keywordtype">void</span>             <a class="code" href="smartmotor_8c.html#a227e5bfde789cec3d0b83cc9d3549914" title="Disable current limit by using a preset threshold. ">SmartMotorCurrentMonitorDisable</a>( <span class="keywordtype">void</span> );</div>
<div class="line"><a name="l00317"></a><span class="lineno"><a class="code" href="smartmotor_8h.html#a75d8cfe5e1f646f72e1ac69c0147e65a">  317</a></span>&#160;<span class="preprocessor">#define          SmartMotorSetLimitCurent(index, ... ) \</span></div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="preprocessor">                 _SmartMotorSetLimitCurent( index, ##__VA_ARGS__, 1.0 )</span></div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="preprocessor"></span><span class="keywordtype">void</span>             <a class="code" href="smartmotor_8c.html#a6fb816815baea9d44c3f812a88759330" title="Set Motor current limit. ">_SmartMotorSetLimitCurent</a>( <a class="code" href="vexmotor_8h.html#a1233a4fb09fef02c962ccec318e00c97" title="Motor port numbers. ">tVexMotor</a> index, <span class="keywordtype">float</span> current, ... );</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;<span class="keywordtype">void</span>             <a class="code" href="smartmotor_8c.html#a27a4a6c5a731ca7889c80f83791531a1" title="Set Motor maximum rpm. ">SmartMotorSetFreeRpm</a>( <a class="code" href="vexmotor_8h.html#a1233a4fb09fef02c962ccec318e00c97" title="Motor port numbers. ">tVexMotor</a> index, <span class="keywordtype">short</span> max_rpm );</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;<span class="keywordtype">void</span>             <a class="code" href="smartmotor_8c.html#af9bb54b61dddaed512ee609db60dd272" title="Set Motor slew rate. ">SmartMotorSetSlewRate</a>( <a class="code" href="vexmotor_8h.html#a1233a4fb09fef02c962ccec318e00c97" title="Motor port numbers. ">tVexMotor</a> index, <span class="keywordtype">int</span> slew_rate );</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;<span class="keywordtype">void</span>             <a class="code" href="smartmotor_8c.html#aab976ab79d0bf527bbf7fa07e443fb42" title="Start the smart motor monitoring. ">SmartMotorRun</a>( <span class="keywordtype">void</span> );</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;<span class="keywordtype">void</span>             <a class="code" href="smartmotor_8c.html#a4e7dbe80bdac2566db9b3a5fcf39f4cd" title="Stop smart motor tasks. ">SmartMotorStop</a>( <span class="keywordtype">void</span> );</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<span class="keywordtype">void</span>             <a class="code" href="smartmotor_8c.html#a6faa54fa874397c29fce371c5f97b0e7" title="Set Controller status LED. ">SmartMotorSetControllerStatusLed</a>( <span class="keywordtype">int</span> index, <a class="code" href="vexdigital_8h.html#ada6c474f1f434058485c115c087767ca" title="Digital pin indexes. ">tVexDigitalPin</a> port );</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;<span class="keywordtype">void</span>             <a class="code" href="smartmotor_8c.html#ac844e981b27f5c1af76547e1b9924e7c" title="Set power expander status port. ">SmartMotorSetPowerExpanderStatusPort</a>( <a class="code" href="vexanalog_8h.html#ab4e1c36487e5604a953fd4112fa1a8e9" title="enumeration for the 8 analog ports ">tVexAnalogPin</a> port );</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;<span class="keywordtype">void</span>             <a class="code" href="smartmotor_8c.html#a9a4557f565013b4d0ba6da748b0e1545" title="Dump controller and motor status to the debug stream. ">SmartMotorDebugStatus</a>(<span class="keywordtype">void</span>);</div>
<div class="line"><a name="l00327"></a><span class="lineno"><a class="code" href="smartmotor_8h.html#ad55b9f0f03f53357cd145124ad10aeed">  327</a></span>&#160;<span class="preprocessor">#define          SmartMotorSetRpmSensor( index, port, ticks_per_rev, ... ) \</span></div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="preprocessor">                 _SmartMotorSetRpmSensor( index, port, ticks_per_rev, ##__VA_ARGS__, FALSE )</span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="preprocessor"></span><span class="keywordtype">void</span>             <a class="code" href="smartmotor_8c.html#a8031e89f924d781680d357b785552b99" title="Assign (non encoder) sensor for rpm measurement. ">_SmartMotorSetRpmSensor</a>( <a class="code" href="vexmotor_8h.html#a1233a4fb09fef02c962ccec318e00c97" title="Motor port numbers. ">tVexMotor</a> index, <a class="code" href="vexanalog_8h.html#ab4e1c36487e5604a953fd4112fa1a8e9" title="enumeration for the 8 analog ports ">tVexAnalogPin</a> port, <span class="keywordtype">float</span> ticks_per_rev, bool_t revesed, ... );</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;</div>
<div class="line"><a name="l00331"></a><span class="lineno"><a class="code" href="smartmotor_8h.html#a4d52a5e1754962a59621bf8aa897b4b4">  331</a></span>&#160;<span class="preprocessor">#define          SetMotor( index, value, ... ) \</span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;<span class="preprocessor">                 _SetMotor( index, value, ##__VA_ARGS__, FALSE )</span></div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;<span class="preprocessor"></span><span class="keywordtype">void</span>             <a class="code" href="smartmotor_8c.html#af00cc3c5f3aeec6476139ca32baadf63" title="Set motor to value. ">_SetMotor</a>( <span class="keywordtype">int</span> index, <span class="keywordtype">int</span> value,  bool_t immediate, ... );</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;<span class="comment">// Access raw data</span></div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<a class="code" href="structsmart_motor.html">smartMotor</a>      *<a class="code" href="smartmotor_8c.html#a7d44058bf6d58da66cbd99c61cfbc639" title="Get pointer to smartMotor structure - not used locally. ">SmartMotorGetPtr</a>( <a class="code" href="vexmotor_8h.html#a1233a4fb09fef02c962ccec318e00c97" title="Motor port numbers. ">tVexMotor</a> index );</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;<a class="code" href="struct__smart_controller.html">smartController</a> *<a class="code" href="smartmotor_8c.html#a8ca350fdeab68b0c71c8df78c86b497f" title="Get pointer to smartController structure - not used locally. ">SmartMotorControllerGetPtr</a>( <span class="keywordtype">short</span> index );</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;<span class="comment">// Private functions for reference</span></div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;<span class="keywordtype">void</span>             <a class="code" href="smartmotor_8c.html#aa144c95835a3a6f710c4dda3b7ca8f1f" title="calculate speed in rpm for the motor ">SmartMotorSpeed</a>( <a class="code" href="structsmart_motor.html">smartMotor</a> *m, <span class="keywordtype">int</span> deltaTime );</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="keywordtype">void</span>             <a class="code" href="smartmotor_8c.html#ac2067868646a1fc6320aae4ef966b21f" title="calculate a simulated speed in rpm for a motor ">SmartMotorSimulateSpeed</a>( <a class="code" href="structsmart_motor.html">smartMotor</a> *m );</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;<span class="keywordtype">float</span>            <a class="code" href="smartmotor_8c.html#a0b57da940b231cb46537e25a798e2605" title="Estimate smart motor current. ">SmartMotorCurrent</a>( <a class="code" href="structsmart_motor.html">smartMotor</a> *m, <span class="keywordtype">float</span> v_battery  );</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="keywordtype">float</span>            <a class="code" href="smartmotor_8c.html#a3b466ecd01cce0df66c503b9043e5872" title="Calculate the current for a controller bank. ">SmartMotorControllerCurrent</a>( <a class="code" href="struct__smart_controller.html">smartController</a> *s );</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="keywordtype">int</span>              <a class="code" href="smartmotor_8c.html#a53b90aedd12a70d0e6bacd976fd1360e" title="Calculate safe current command. ">SmartMotorSafeCommand</a>( <a class="code" href="structsmart_motor.html">smartMotor</a> *m, <span class="keywordtype">float</span> v_battery  );</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;<span class="keywordtype">float</span>            <a class="code" href="smartmotor_8c.html#af34b0a6188274246212c7ac78f81e045" title="Calculate the PTC temperature for a motor. ">SmartMotorTemperature</a>( <a class="code" href="structsmart_motor.html">smartMotor</a> *m, <span class="keywordtype">int</span> deltaTime );</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;<span class="keywordtype">float</span>            <a class="code" href="smartmotor_8c.html#a211427153976aefbc636a1b966d3dbe0" title="Calculate the PTC temperature for a controller bank. ">SmartMotorControllerTemperature</a>( <a class="code" href="struct__smart_controller.html">smartController</a> *s, <span class="keywordtype">int</span> deltaTime  );</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;<span class="keywordtype">void</span>             <a class="code" href="smartmotor_8c.html#a3fcbaf9a9c8018c10ac8a8d5d3cb56a4" title="Monitor Motor PTC temperature. ">SmartMotorMonitorPtc</a>( <a class="code" href="structsmart_motor.html">smartMotor</a> *m, <span class="keywordtype">float</span> v_battery );</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<span class="keywordtype">void</span>             <a class="code" href="smartmotor_8c.html#a18c365193c6178e1674b08b09b5ae91c" title="Monitor controller bank PTC temperature. ">SmartMotorControllerMonitorPtc</a>( <a class="code" href="struct__smart_controller.html">smartController</a> *s, <span class="keywordtype">float</span> v_battery );</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;<span class="keywordtype">void</span>             <a class="code" href="smartmotor_8c.html#ad671e19c837b6b1f3ae95bf85d4f2166" title="Monitor Motor Current. ">SmartMotorMonitorCurrent</a>( <a class="code" href="structsmart_motor.html">smartMotor</a> *m, <span class="keywordtype">float</span> v_battery );</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;<span class="keywordtype">void</span>             <a class="code" href="smartmotor_8c.html#a824d6d1c9472b7f86b3cf07a233144e5" title="Set the current monitor LED on or off. ">SmartMotorControllerSetLed</a>( <a class="code" href="struct__smart_controller.html">smartController</a> *s );</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;msg_t            <a class="code" href="smartmotor_8c.html#affafa43d662163258c459227c42c32b9" title="The smart motor task. ">SmartMotorTask</a>( <span class="keywordtype">void</span> *arg );</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;msg_t            <a class="code" href="smartmotor_8c.html#a7e1dfd9a54afaeb2f0cd8ec6d1de4e9c" title="The motor slew rate task. ">SmartMotorSlewRateTask</a>( <span class="keywordtype">void</span> *arg );</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;<span class="preprocessor">#endif  // __SMARTMOTORLIB__</span></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_39cce2f8bb217932b254ee6294567f16.html">vex</a></li><li class="navelem"><a class="el" href="dir_b5e8d6cab5ffd968b3bd427c6c6f2b80.html">cortex</a></li><li class="navelem"><a class="el" href="dir_9e5b02898a8d6230f8834953bb890d5b.html">opt</a></li><li class="navelem"><a class="el" href="smartmotor_8h.html">smartmotor.h</a></li>
    <li class="footer">Generated on Tue Jun 25 2013 10:11:00 for Convex by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.4 </li>
  </ul>
</div>
</body>
</html>
