<!-- HTML header for doxygen 1.8.4-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.4"/>
<title>Convex: Multi-tasking</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0" class="pageheader">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="convex_logo.png"/></td>
  <td width="100%" align="center" valign="bottom"></td>
  <td align="right"></td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.4 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('threads.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Multi-tasking </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>As ConVEX is built upon the ChibiOS API, multi-tasking is straightforward and uses it's native multi threading features.</p>
<p>ConVEX creates several default systems tasks.</p>
<table class="doxtable">
<tr>
<th>name </th><th align="center">priority </th><th>type </th><th>description  </th></tr>
<tr>
<td>main </td><td align="center">64 </td><td>static </td><td>main program </td></tr>
<tr>
<td>system </td><td align="center">74 </td><td>static </td><td>communicate with the master processor </td></tr>
<tr>
<td>monitor </td><td align="center">72 </td><td>static </td><td>competition control monitor task </td></tr>
<tr>
<td>ime </td><td align="center">73 </td><td>static </td><td>IME background polling </td></tr>
<tr>
<td>sonar </td><td align="center">72 </td><td>static </td><td>ultrasonic sensor polling - if a sonar is enabled </td></tr>
<tr>
<td>lcd </td><td align="center">64 </td><td>static </td><td>LCD display communications </td></tr>
<tr>
<td>audio </td><td align="center">64 </td><td>heap </td><td>audio tone and rttl playback - if audio is enabled </td></tr>
<tr>
<td>shell </td><td align="center">64 </td><td>static </td><td>shell (command line) </td></tr>
<tr>
<td>operator </td><td align="center">65 </td><td>static </td><td>driver control - started from monitor thread </td></tr>
<tr>
<td>auton </td><td align="center">65 </td><td>static </td><td>autonomous - started from monitor thread </td></tr>
</table>
<p>To create a static task using the ChibiOS API, code in the following form is used. If the task needs to be stopped by competition control then vexTaskRegister should be called near the beginning of the task and vexSleep called to yeild processing rather than the ChibiOS function chThdSleepMilliseconds.</p>
<div class="fragment"><div class="line"><span class="comment">// memory for task - use the WORKING_AREA macro</span></div>
<div class="line"><span class="keyword">static</span> WORKING_AREA(waVexTestThread, 512);</div>
<div class="line"><span class="keyword">static</span> msg_t</div>
<div class="line">vexTestThread( <span class="keywordtype">void</span> *arg )</div>
<div class="line">{</div>
<div class="line">  (void)arg;</div>
<div class="line">  <span class="comment">// register the task so competition control can kill it</span></div>
<div class="line">  <a class="code" href="vex_8h.html#a08847f8db8d168c4f8acad495beda363" title="Register a thread so it can be terminated during vexSleep. ">vexTaskRegister</a>((<span class="stringliteral">&quot;test&quot;</span>);</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// thread processing</span></div>
<div class="line">  <span class="keywordflow">while</span> (TRUE)</div>
<div class="line">      {</div>
<div class="line">    <span class="comment">// use vexSleep rather than chThdSleepMilliseconds</span></div>
<div class="line">      <a class="code" href="vex_8h.html#a0069824f3952a61165be297146701489" title="Sleep for given number of ms. ">vexSleep</a>(25);</div>
<div class="line">      }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span> (msg_t)0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">MyFunc()</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Creates the test thread.</span></div>
<div class="line">    chThdCreateStatic(waVexTestThread, <span class="keyword">sizeof</span>(waVexTestThread), NORMALPRIO-1, vexTestThread, NULL);</div>
<div class="line">}</div>
</div><!-- fragment --><p>See <a class="el" href="vexcortex_8c.html" title="Cortex initialization and system tasks. ">vexcortex.c</a> for more information on <a class="el" href="vexcortex_8c.html#a08847f8db8d168c4f8acad495beda363">vexTaskRegister</a> and other thread related functions.</p>
<p>An alternative way of creating tasks uses a ROBOTC style API.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="robotc__glue_8h.html" title="Header for ROBOTC glue functions. ">robotc_glue.h</a>&quot;</span></div>
<div class="line"></div>
<div class="line"><a class="code" href="robotc__glue_8h.html#a8bc22769f445ed91abfcbac376dea14d" title="ROBOTC &quot;tasks&quot; return type task. ">task</a></div>
<div class="line">vexTestThread( <span class="keywordtype">void</span> *arg )</div>
<div class="line">{</div>
<div class="line">  (void)arg;</div>
<div class="line"></div>
<div class="line">  <a class="code" href="vex_8h.html#a08847f8db8d168c4f8acad495beda363" title="Register a thread so it can be terminated during vexSleep. ">vexTaskRegister</a>(<span class="stringliteral">&quot;test&quot;</span>);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">while</span> (TRUE)</div>
<div class="line">      {</div>
<div class="line">      <a class="code" href="robotc__glue_8h.html#a772c899f95d918afe02f3201f3e4e219" title="delay compatibility shortcut ">wait1Msec</a>(25);</div>
<div class="line">      }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span> (msg_t)0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">MyFunc()</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Creates the test thread.</span></div>
<div class="line">    <a class="code" href="robotc__glue_8h.html#af4543c25ec70dbf7d2d11dd3971c61e7" title="Macro to simulate the ROBOTC StartTask function. ">StartTask</a>( vexTestThread );</div>
<div class="line">}</div>
</div><!-- fragment --><p>This creates the thread using dynamic memory allocation and allocates a fixed 512 bytes for it. The task should still be registered using vexTaskRegister so competition control can stop it if necessary.</p>
<p>See <a class="el" href="robotc__glue_8c.html" title="Some glue functions to make porting ROBOTC coe easier. ">robotc_glue.c</a> and <a class="el" href="robotc__glue_8h.html" title="Header for ROBOTC glue functions. ">robotc_glue.h</a> for more details on ROBOTC style tasks. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="basics.html">The Basics</a></li>
    <li class="footer">Generated on Sun Jan 5 2014 15:43:38 for Convex by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.4 </li>
  </ul>
</div>
</body>
</html>
