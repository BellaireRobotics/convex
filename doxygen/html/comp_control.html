<!-- HTML header for doxygen 1.8.4-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.4"/>
<title>Convex: Competition control</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0" class="pageheader">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="convex_logo.png"/></td>
  <td width="100%" align="center" valign="bottom"></td>
  <td align="right"></td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.4 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('comp_control.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Competition control </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>There are few differences in the way competition control is handled in ConVEX as compared to ROBOTC and EasyC. In all cases the indication of disabled, driver or autonomous periods comes from the master processor as part of the background communication between it and the user processor. EasyC literally resets the user processor when it detects a change of state, this causes havoc with variables that may need to be retained between the different competition periods but is the only way it can interrupt and reset code that may be, for example, waiting for sensors or performing other lenghty operations. ROBOTC has the oportunity to stop user code and tasks at any point as control of the processor returns to the ROBOTC operating system between each line of user code.</p>
<p>ConVEX takes a more cooporative approach to the problem, it does not use the brute force mechanism of EasyC and, because it is running native ARM code, cannot force a thread or function to stop running at any arbitary point. Every thread in ConVEX that needs to be under competition control must register with a supervisory thread and avoid long periods of operation without calling back to the system via a "vexSleep" call.</p>
<p>With the V1.00 release of ConVEX, every program runs expecting VEXnet to be present and, if the competition switch is connected, will run in a competition mode.</p>
<p>User code is usually started from functions in the <a class="el" href="vexuser_8c.html" title="Example of vexuser.c. ">vexuser.c</a> file, four functions should normally be provided, although the setup functions are technically optional. Here is a skeleton <a class="el" href="vexuser_8c.html" title="Example of vexuser.c. ">vexuser.c</a> file.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &quot;ch.h&quot;</span>         <span class="comment">// needs for all ChibiOS programs</span></div>
<div class="line"><span class="preprocessor">#include &quot;hal.h&quot;</span>        <span class="comment">// hardware abstraction layer header</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="vex_8h.html" title="Main vex include file. ">vex.h</a>&quot;</span>        <span class="comment">// vex library header</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line"><a class="code" href="vex_8h.html#ac5b7557d665fb6e6dc124f8f891f9a0b" title="User setup. ">vexUserSetup</a>()</div>
<div class="line">{</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/*-----------------------------------------------------------------------------*/</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line"><a class="code" href="vex_8h.html#a8817d8150444d94744f9771725acc712" title="User initialize. ">vexUserInit</a>()</div>
<div class="line">{</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/*-----------------------------------------------------------------------------*/</span></div>
<div class="line">msg_t</div>
<div class="line"><a class="code" href="vex_8h.html#a287b65e0518551afca65e5b7b19a44d9" title="Autonomous. ">vexAutonomous</a>( <span class="keywordtype">void</span> *arg )</div>
<div class="line">{</div>
<div class="line">    (void)arg;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Must call this</span></div>
<div class="line">    <a class="code" href="vex_8h.html#a08847f8db8d168c4f8acad495beda363" title="Register a thread so it can be terminated during vexSleep. ">vexTaskRegister</a>(<span class="stringliteral">&quot;auton&quot;</span>);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">while</span>(!chThdShouldTerminate())</div>
<div class="line">        {</div>
<div class="line">        <span class="comment">// Don&#39;t hog cpu</span></div>
<div class="line">        <a class="code" href="vex_8h.html#a0069824f3952a61165be297146701489" title="Sleep for given number of ms. ">vexSleep</a>( 25 );</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> (msg_t)0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/*-----------------------------------------------------------------------------*/</span></div>
<div class="line">msg_t</div>
<div class="line"><a class="code" href="vex_8h.html#a2a32915075b519dbc7c34af7f2e16c46" title="Driver control. ">vexOperator</a>( <span class="keywordtype">void</span> *arg )</div>
<div class="line">{</div>
<div class="line">    (void)arg;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Must call this</span></div>
<div class="line">    <a class="code" href="vex_8h.html#a08847f8db8d168c4f8acad495beda363" title="Register a thread so it can be terminated during vexSleep. ">vexTaskRegister</a>(<span class="stringliteral">&quot;operator&quot;</span>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Run until asked to terminate</span></div>
<div class="line">    <span class="keywordflow">while</span>(!chThdShouldTerminate())</div>
<div class="line">        {</div>
<div class="line">        <span class="comment">// Don&#39;t hog cpu</span></div>
<div class="line">        <a class="code" href="vex_8h.html#a0069824f3952a61165be297146701489" title="Sleep for given number of ms. ">vexSleep</a>( 25 );</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> (msg_t)0;</div>
<div class="line">}   </div>
</div><!-- fragment --><p><a class="el" href="vexuser_8c.html#aefb6f7fadd163e6930552ee39b54eaee">vexUserSetup</a> is normally where sensors and motors are defined, this is called early in the initialization process before interrupts are started for such things as ultrasonic sensors and quad encoders.</p>
<p><a class="el" href="vexuser_8c.html#a425649926da4b3fcaaf8ae65b704dd38">vexUserInit</a> is called later on but before competition control monitoring starts. By this time most things have been initialized including, for example, IMEs. This is a function where one time initialization of variables can be done or permanant user threads such as the smart motor library started.</p>
<p><a class="el" href="vexuser_8c.html#a287b65e0518551afca65e5b7b19a44d9">vexAutonomous</a> is started when the competition control monitor detects the start of that period.</p>
<p><a class="el" href="vexuser_8c.html#a2a32915075b519dbc7c34af7f2e16c46">vexOperator</a> is started when the competition control monitor detects the start of that period.</p>
<p>This diagram shows this graphically.</p>
<div class="image">
<img src="convex_user_code.jpg" alt="convex_user_code.jpg"/>
</div>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Thu Aug 29 2013 10:39:42 for Convex by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.4 </li>
  </ul>
</div>
</body>
</html>
